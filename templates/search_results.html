{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results - StreamNest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * 
        { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        body 
        { 
            font-family: 'Segoe UI', sans-serif; 
            background: #181818; 
            color: #f5f5f5; 
        }
        header 
        { 
            background: #141414; 
            padding: 20px 40px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .logo 
        { 
            font-size: 2rem; 
            color: #ff385c; 
            font-weight: bold; 
            letter-spacing: 2px; 
            text-decoration: none; 
        }
        nav a 
        { 
            color: #f5f5f5; 
            margin-left: 30px; 
            text-decoration: none; 
            font-size: 1.1rem; 
            transition: color 0.2s; 
        }
        nav a:hover 
        { 
            color: #ff385c; 
        }
        .dropdown 
        { 
            position: relative; 
            display: inline-block; 
            cursor: pointer; 
        }
        .username 
        { 
            color: #f5f5f5; 
            font-size: 1.1rem; 
            margin-left: 30px; 
        }
        .username:hover 
        { 
            color: #ff385c; 
        }
        .dropdown-content 
        { 
            display: none; 
            position: absolute; 
            right: 0; 
            background-color: #23232b; 
            min-width: 160px; 
            border-radius: 8px; 
            box-shadow: 0px 4px 8px rgba(0,0,0,0.4); 
            z-index: 1; 
        }
        .dropdown-content a 
        { 
            color: #f5f5f5; 
            padding: 10px 16px; 
            text-decoration: none; 
            display: block; 
            font-size: 1rem; 
        }
        .dropdown-content a:hover 
        { 
            background-color: #ff385c; 
            color: #23232b; 
        }
        .dropdown:hover .dropdown-content 
        { 
            display: block; 
        }
        .subscription-info 
        { 
            padding: 8px 12px; 
            font-size: 13px; 
            color: #00c853; 
            font-weight: 500; 
            background: rgba(0, 200, 83, 0.1); 
            border-radius: 6px; 
            margin: 6px 10px; 
            text-align: center; 
        }
        .subscription-info.expired 
        { 
            color: #e53935; 
            background: rgba(229, 57, 53, 0.1); 
        }
        .search-bar 
        { 
            display: flex; 
            justify-content: center; 
            margin: 20px 0; 
        }
        .search-bar input 
        { 
            width: 50%; 
            padding: 10px 15px; 
            font-size: 1rem; 
            border-radius: 8px 0 0 8px; 
            border: 1px solid #444; 
            background: #23232b; 
            color: #fff; 
        }
        .search-bar button 
        { 
            padding: 10px 15px; 
            border: none; 
            background: #ff385c; 
            color: #fff; 
            font-size: 1rem; 
            border-radius: 0 8px 8px 0; 
            cursor: pointer; 
        }
        .search-bar button:hover 
        { 
            background: #b31539; 
        }
        .movie-grid 
        { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            justify-content: center; 
            margin: 20px; 
        }
        .card 
        { 
            width: 180px; 
            background: #23232b; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.5); 
            transition: transform 0.3s; 
            position: relative; 
        }
        .card:hover 
        { 
            transform: scale(1.05); 
        }
        .poster 
        { 
            width: 100%; 
            height: 240px; 
            object-fit: cover; 
            border-bottom: 2px solid #333; 
        }
        .details 
        { 
            padding: 8px; 
        }
        .title 
        { 
            font-size: 1rem; 
            font-weight: bold; 
            margin-bottom: 6px; 
            color: #fff; 
        }
        .description 
        { 
            font-size: 0.8rem; 
            color: #bbb; 
            margin-bottom: 6px; 
        }
        .release 
        { 
            font-size: 0.7rem; 
            color: #888; 
        }
        .actions 
        { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 8px; 
            padding: 8px; 
            background: #1c1c22; 
            border-top: 1px solid #333; 
            opacity: 0; 
            visibility: hidden; 
            transform: translateY(10px); 
            transition: all 0.3s ease-in-out; 
        }
        .card:hover .actions 
        { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
        }
        .actions button 
        { 
            background: #ff385c; 
            border: none; 
            padding: 6px 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.8rem; 
            color: white; 
            transition: background 0.2s; 
        }
        .actions button:hover 
        { 
            background: #b31539; 
        }
        .video-container 
        { 
            display: none; 
            position: relative; 
            margin-top: 5px; 
        }
        .video-controls 
        { 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            margin-top: 5px; 
        }
        .video-controls button 
        { 
            background: #ff385c; 
            border: none; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 0.8rem; 
            color: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.2s; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.4); 
        }
        .video-controls button:hover 
        { 
            background: #b31539; 
            transform: scale(1.1); 
            box-shadow: 0 5px 10px rgba(0,0,0,0.5); 
        }
        .video-controls button:active 
        { 
            transform: scale(0.95); 
        }
        @media (max-width: 700px) 
        { 
            .movie-grid { flex-direction: column; gap: 12px; } 
            .search-bar input { width: 70%; } 
        }
    </style>
</head>
<body>
    <header>
        <a href="{% url 'home' %}" class="logo">StreamNest</a>
        <nav>
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'movie_list' %}">Movies</a>
            <a href="{% url 'series_list' %}">Series</a>
            <a href="{% url 'watchlist' %}">Watchlist</a>
            <div class="dropdown">
                <span class="username">{{ user.username }} ▾</span>
                <div class="dropdown-content">
                    {% if subscription_end %}
                        <p class="subscription-info">Valid till: <strong>{{ subscription_end|date:"M d, Y" }}</strong></p>
                    {% else %}
                        <p class="subscription-info">No active subscription</p>
                    {% endif %}
                    <a href="{% url 'logout' %}">Sign Out</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="search-bar">
        <form method="get" action="{% url 'search' %}">
            <input type="text" name="q" placeholder="Search for movies or series..." value="{{ query }}">
            <button type="submit">Search</button>
        </form>
    </div>

    <h1 style="text-align:center; color:#ff385c;">Search Results for "{{ query }}"</h1>

    <div class="movie-grid">
        {% for result in results %}
        <div class="card">
            <img src="{{ result.poster.url|default:'https://via.placeholder.com/180x240.png?text=No+Poster' }}" alt="{{ result.title }}" class="poster">
            <div class="details">
                <div class="title">{{ result.title }}</div>
                <div class="description">{{ result.description|truncatechars:70 }}</div>
                <div class="release"><b>Release:</b> {{ result.release_date }}</div>
            </div>
            <div class="actions">
                {% if result.get_type == 'movie' %}
                <a href="{% url 'add_to_watchlist' 'movie' result.id %}"><button>➕ Watchlist</button></a>
                {% if result.video %}
                <button onclick="playVideo('m{{ result.id }}')">▶ Play</button>
                <div id="video-container-m{{ result.id }}" class="video-container">
                    <video id="video-m{{ result.id }}" controls>
                        <source src="{{ result.video.url }}" type="video/mp4">
                    </video>
                    <div class="video-controls">
                        <button onclick="rewind('m{{ result.id }}')">⏪ 10s</button>
                        <button onclick="skip('m{{ result.id }}')">⏩ 10s</button>
                        <button onclick="closeVideo('m{{ result.id }}')">❌ Close</button>
                    </div>
                </div>
                {% endif %}
                {% elif result.get_type == 'series' %}
                <a href="{% url 'add_to_watchlist' 'series' result.id %}"><button>➕ Watchlist</button></a>
                <a href="{% url 'series_detail' result.id %}"><button>▶ Play </button></a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p style="color:white; text-align:center;">No results found.</p>
        {% endfor %}
    </div>

    <script>
        function playVideo(id) 
        {
            const container = document.getElementById(`video-container-${id}`);
            const video = document.getElementById(`video-${id}`);
            container.style.display = "block";
            video.play();
            if (container.requestFullscreen) container.requestFullscreen();
        }
        function closeVideo(id) 
        {
            const container = document.getElementById(`video-container-${id}`);
            const video = document.getElementById(`video-${id}`);
            video.pause();
            video.currentTime = 0;
            if (document.fullscreenElement) document.exitFullscreen();
            container.style.display = "none";
        }
        function skip(id) 
        {
            const video = document.getElementById(`video-${id}`);
            if(video) video.currentTime += 10;
        }
        function rewind(id) 
        {
            const video = document.getElementById(`video-${id}`);
            if(video) video.currentTime -= 10

        }
    </script>
</body>
</html>

